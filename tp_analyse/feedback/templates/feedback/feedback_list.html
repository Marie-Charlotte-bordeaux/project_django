{% extends 'base.html' %} {% load static %}

<!-- TITLE -->
{% block title %}💬 Feedbacks pour « {{ job.job_title }} »{% endblock %}

<!-- BODY -->
{% block content %}
<div class="max-w-4xl mx-auto space-y-8">
  <!-- Titre -->
  <h2 class="text-3xl font-bold text-pink-400">
    💬 Feedbacks pour « {{ job.job_title }} »
  </h2>

  <!-- Boutons -->
  <div class="flex flex-wrap gap-4">
    <a
      href="{% url 'add-feedback' job.id %}"
      class="px-4 py-2 bg-pink-600 hover:bg-pink-700 rounded text-white shadow"
    >
      ➕ Ajouter un feedback
    </a>
    <a
      href="{% url 'job-list' %}"
      class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-white shadow"
    >
      ⬅️ Retour aux jobs
    </a>
  </div>

  <!-- Formulaire de filtre -->
  <form method="get" class="flex flex-wrap items-center gap-2">
    <label for="min_rating" class="text-pink-300">Note exacte :</label>
    <input
      type="number"
      name="min_rating"
      id="min_rating"
      min="1"
      max="5"
      value="{{ request.GET.min_rating|default_if_none:'' }}"
      class="w-24 px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white"
    />
    <button
      type="submit"
      class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded"
    >
      Filtrer
    </button>
    {% if request.GET.min_rating %}
    <a
      href="{% url 'feedback-list-front' job.id %}"
      class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded"
    >
      ❌ Réinitialiser
    </a>
    {% endif %}
  </form>

  {% if request.GET.min_rating %}
  <p class="text-sm text-purple-300">
    Filtre actif : Note = {{ request.GET.min_rating }}
  </p>
  {% endif %}

  <!-- Conteneur pour l'injection dynamique des feedbacks -->
  <div id="feedback-list" class="space-y-4">
    <!-- Le JS injecte les feedbacks ici -->
  </div>
</div>

<!-- Données pour le script -->
<script type="text/javascript">
  console.log("🎉 feedback.js chargé !");
  window.JOB_ID = "{{ job.id }}";
  window.API_TOKEN = "{{ user.auth_token.key|default:'' }}";
</script>

{% block js %}
<script type="text/javascript" src="{% static 'js/feedback.js' %}"></script>
{% endblock %} {% endblock %}
